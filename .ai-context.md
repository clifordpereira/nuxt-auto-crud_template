# AI Context: Nuxt Auto-CRUD (Clifland Model)

## üéØ System Architecture

This repository is the **Abstract Class**‚Äîa standardized implementation blueprint.

* **Interface (The Core):** [nuxt-auto-crud](https://github.com/clifordpereira/nuxt-auto-crud). The headless engine (dependency). Manages runtime reflection, Drizzle-Zod integration, and dynamic Nitro endpoints.
* **Abstract Class (The Template):** This repository. Defines Nuxt 4 `app/` structure, UI (Nuxt UI 4), and configuration patterns. Business-logic agnostic.
* **Concrete Class (The App):** Derivative projects (e.g., JMS, FMS) that consume this template and define domain-specific Drizzle schemas.
* **Instance (The Object):** Final deployment; a Concrete Class + client-specific DB/config.



## üì° Dynamic API Discovery (Runtime Reflection)

**CRITICAL:** Do NOT search for static CRUD API route files.

* **Discovery Mechanism:** NAC Core introspects exported tables from `server/db/schema/*.ts`.
* **Live Metadata:** Use `GET /api/_meta` for versioning, resource availability, and field definitions.
* **Endpoint Pattern:** `/api/[plural_table_name]` (e.g., `/api/users`).
* **Validation:** Automatic via `drizzle-zod`.
* **Agent Workflow:** You MUST read schema files in `server/db/schema/` or query `_meta` before proposing operations.

### High-Fidelity Metadata Signals
* **`labelField`**: Identifies the primary human-readable field (e.g., `name`, `title`).
* **`isRelation`**: Boolean flag for FK relationships.
* **`references`**: Maps the target resource (e.g., `roleId` -> `roles`).

## üõ°Ô∏è Operational Protocols

* **Protected Fields:** `id`, `createdAt`, `updatedAt`, `deletedAt` are system-managed. Do not include in `POST`/`PATCH` payloads.
* **Soft Deletes:** Enabled globally. NAC filters `deletedAt IS NOT NULL` at the Nitro layer.
* **Auth/RBAC:** Enforced via `roleResourcePermissions`. UI visibility uses `<Can>` components.
* **DRY Logic:** Logic belongs in the Core (Interface). UI/Blueprint belongs here (Abstract Class).

## üìÇ Key Directories

* `server/db/schema/`: **Single Source of Truth** for Data Model & API.
* `server/utils/schema.ts`: Reflection logic for `_meta` generation.
* `app.config.ts`: Global UI configuration, roles, and seed data.
* `nuxt.config.ts`: Module source and NAC granular field visibility.
