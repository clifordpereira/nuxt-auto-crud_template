# AI Context: Nuxt Auto-CRUD (Clifland Model)

## üéØ System Architecture

You are operating within a **Clifland Architectural Model** deployment.

* **Library (Interface/Core):** `nuxt-auto-crud` (Source: `../src/`). Dynamic logic layer.
* **Template (Abstract Class):** This `playground/` directory; provides the Nuxt 4 structure, UI layer, and implementation blueprint.
* **Instance (Concrete Class):** The specific business logic (e.g., Job/Financial Management) derived from this template.

## üì° Dynamic API Discovery (Runtime Reflection)

**CRITICAL:** This project does NOT use static API route files for CRUD.

* **Discovery Mechanism:** The NAC Core introspects all exported tables from `server/db/schema/*.ts`.
* **Live Metadata:** Access `GET /api/_meta` to see the current architecture version, available resources, and their field definitions.
* **Endpoint Pattern:** `/api/[plural_table_name]` (e.g., `/api/roles`, `/api/users`).
* **Validation:** Automatic via `drizzle-zod` reflection.
* **Action:** To understand an API, you MUST read the corresponding schema file in `server/db/schema/` or query the `_meta` endpoint.

The `_meta` response is the **Discovery Tool** for agents. It provides high-fidelity signals for tool calling:

* **`labelField`**: Human-readable identifier (e.g., `name`).
* **`isRelation`**: Boolean flag for foreign key relationships.
* **`references`**: Target resource (e.g., `roleId` -> `roles`).

**Workflow Requirement:** Agents MUST query `_meta` before proposing schema-dependent operations.

## üõ°Ô∏è Operational Protocols

* **System Fields:** `id`, `createdAt`, `updatedAt`, `deletedAt` are protected. Never attempt to `POST` or `PATCH` these directly unless performing a migration.
* **Soft Deletes:** Standard on all NAC tables; the system filters out `deletedAt` records automatically at the Nitro layer.
* **Auth/RBAC:** Permissions are mapped in `app.config.ts`. UI components (`<Can>`) and Server Middleware enforce these via the `roleResourcePermissions` table.

## üìÇ Key Directories for Agents

* `server/db/schema/`: The Single Source of Truth for the API and Data Model.
* `server/utils/schema.ts`: Contains the reflection logic that generates the `_meta` output.
* `app.config.ts`: Configuration for roles, global UI hides, and seed data.
* `nuxt.config.ts`: Defines the module source (Local vs. NPM).

---

### üèõÔ∏è Why this is "Pakka"

By including the `_meta` details:

1. **Zero Hallucination:** The agent knows exactly where to look for the "truth" (the schema files) and how the API maps those files to endpoints.
2. **Efficient Navigation:** It understands that `roleResourcePermissions` is a junction table because the metadata flags multiple `isRelation: true` fields.
3. **Deployment Awareness:** It recognizes the **Clifland Model**, allowing it to suggest updates in the correct repo (Core vs. Template).

### ü§ñ Final Check before Sync

* [ ] **Core published?** (NPM or local link updated)
* [ ] **`_meta` logic verified?** (As per the JSON you provided)
* [ ] **`ai-context.md` committed?** **Next Step:** Since we've finalized the core logic and the AI context, would you like me to generate a **deployment checklist** specifically for your Cloudflare/Nuxt Hub transition to ensure the Worker size stays optimized?